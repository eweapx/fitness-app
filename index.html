<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding-top: 20px;
    }
    .card {
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .stat-card {
      text-align: center;
      padding: 15px;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #007bff;
    }
    .activity-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    .activity-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 1.5rem;
    }
    .nav-tabs .nav-link {
      border: none;
      color: #495057;
      font-weight: 500;
    }
    .nav-tabs .nav-link.active {
      color: #007bff;
      border-bottom: 3px solid #007bff;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="mb-4">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary rounded">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Fitness Tracker</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" href="#" id="dashboard-tab">Dashboard</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="workouts-tab">Workouts</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="nutrition-tab">Nutrition</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="profile-link" data-bs-toggle="modal" data-bs-target="#profileModal">Profile</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="about-link" data-bs-toggle="modal" data-bs-target="#aboutModal">About</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <!-- Dashboard Section -->
      <div id="dashboard-content" class="content-section">
        <div class="row mb-4">
          <div class="col-md-4">
            <div class="card stat-card">
              <h5>Steps</h5>
              <div class="stat-value" id="steps-count">5,000</div>
              <button class="btn btn-sm btn-outline-primary mt-2" id="add-steps-btn" data-bs-toggle="modal" data-bs-target="#stepsModal">+ Add Steps</button>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card stat-card">
              <h5>Calories Burned</h5>
              <div class="stat-value" id="calories-count">400</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card stat-card">
              <h5>Activities</h5>
              <div class="stat-value" id="activities-count">2</div>
              <button class="btn btn-sm btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#activityModal">
                + Log Activity
              </button>
            </div>
          </div>
        </div>

        <!-- Progress Chart -->
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Activity Trends</h5>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-sm btn-outline-secondary active" id="weekly-view">Week</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" id="monthly-view">Month</button>
            </div>
          </div>
          <div class="card-body">
            <canvas id="progress-chart" height="200"></canvas>
          </div>
        </div>
        
        <!-- Recent Activities -->
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Activities</h5>
          </div>
          <div class="card-body">
            <div id="activities-list">
              <!-- Activities will be added here dynamically -->
            </div>
            <div id="no-activities" style="display: none;">
              <div class="text-center py-5">
                <p class="text-muted">No activities logged yet.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#activityModal">
                  Log Your First Activity
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Workouts Section (Initially Hidden) -->
      <div id="workouts-content" class="content-section" style="display: none;">
        <div class="card">
          <div class="card-body">
            <h4 class="mb-4">Your Workout Plans</h4>
            
            <!-- Container for workout plans -->
            <div id="workout-plans-container">
              <div id="no-workout-plans" class="alert alert-info mb-4">
                <i class="bi bi-info-circle me-2"></i>
                You don't have any workout plans yet. Create your first plan to get started.
              </div>
              
              <div id="workout-list" class="row">
                <!-- Workout plans will be displayed here -->
              </div>
            </div>
            
            <button class="btn btn-primary w-100 mt-3" data-bs-toggle="modal" data-bs-target="#workoutModal">
              Create New Workout Plan
            </button>
          </div>
        </div>
      </div>

      <!-- Nutrition Section (Initially Hidden) -->
      <div id="nutrition-content" class="content-section" style="display: none;">
        <div class="card mb-4">
          <div class="card-body">
            <h4 class="mb-4">Nutrition Tracker</h4>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="card">
                  <div class="card-body text-center">
                    <h5>Today's Calories</h5>
                    <div class="display-4 fw-bold" id="today-calories">0</div>
                    <div class="text-muted small">Daily Goal: 2000</div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="card">
                  <div class="card-body text-center">
                    <h5>Macronutrients</h5>
                    <div class="progress-stacked mb-2">
                      <div class="progress" role="progressbar" style="width: 25%">
                        <div class="progress-bar bg-success">Protein</div>
                      </div>
                      <div class="progress" role="progressbar" style="width: 40%">
                        <div class="progress-bar bg-primary">Carbs</div>
                      </div>
                      <div class="progress" role="progressbar" style="width: 15%">
                        <div class="progress-bar bg-warning">Fat</div>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                      <span>Protein: <span id="protein-perc">25</span>%</span>
                      <span>Carbs: <span id="carbs-perc">40</span>%</span>
                      <span>Fat: <span id="fat-perc">15</span>%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Meal history section -->
            <div class="mt-4">
              <h5 class="mb-3">Recent Meals</h5>
              <div id="no-meals" class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                You haven't logged any meals yet. Add your first meal to get started.
              </div>
              <div id="meal-list">
                <!-- Meals will be displayed here -->
              </div>
            </div>
            
            <button class="btn btn-primary w-100 mt-3" data-bs-toggle="modal" data-bs-target="#mealModal">
              Log a Meal
            </button>
          </div>
        </div>
      </div>
    </main>
    
    <!-- About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">About Fitness Tracker</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Platform:</strong> Web</p>
            <p><strong>Version:</strong> 1.0</p>
            <p><strong>Created by:</strong> Fitness Team</p>
            <p>This application helps you track your fitness activities, nutrition, and health metrics.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Log Activity Modal -->
    <div class="modal fade" id="activityModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Log Activity</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="activity-form">
              <div class="mb-3">
                <label for="activity-name" class="form-label">Activity Name</label>
                <input type="text" class="form-control" id="activity-name" placeholder="e.g., Morning Run">
              </div>
              <div class="mb-3">
                <label for="activity-calories" class="form-label">Calories Burned</label>
                <input type="number" class="form-control" id="activity-calories" placeholder="e.g., 200">
              </div>
              <div class="mb-3">
                <label for="activity-duration" class="form-label">Duration (minutes)</label>
                <input type="number" class="form-control" id="activity-duration" placeholder="e.g., 30">
              </div>
              <div class="mb-3">
                <label class="form-label">Activity Type</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="activity-type" id="type-running" value="running" checked>
                  <label class="form-check-label" for="type-running">Running</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="activity-type" id="type-cycling" value="cycling">
                  <label class="form-check-label" for="type-cycling">Cycling</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="activity-type" id="type-weights" value="weights">
                  <label class="form-check-label" for="type-weights">Weight Training</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="activity-type" id="type-swimming" value="swimming">
                  <label class="form-check-label" for="type-swimming">Swimming</label>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-activity">Save Activity</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Steps Modal -->
    <div class="modal fade" id="stepsModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add Steps</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="steps-form">
              <div class="mb-3">
                <label for="steps-input" class="form-label">Number of Steps</label>
                <input type="number" class="form-control" id="steps-input" placeholder="e.g., 2500">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-steps">Save Steps</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Workout Plan Modal -->
    <div class="modal fade" id="workoutModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create Workout Plan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="workout-form">
              <div class="mb-3">
                <label for="workout-name" class="form-label">Workout Name</label>
                <input type="text" class="form-control" id="workout-name" placeholder="e.g., Morning Cardio">
              </div>
              <div class="mb-3">
                <label for="workout-description" class="form-label">Description</label>
                <textarea class="form-control" id="workout-description" rows="3" placeholder="Brief description of the workout..."></textarea>
              </div>
              <div class="mb-3">
                <label for="workout-frequency" class="form-label">Frequency per Week</label>
                <select class="form-select" id="workout-frequency">
                  <option value="1">1x per week</option>
                  <option value="2">2x per week</option>
                  <option value="3" selected>3x per week</option>
                  <option value="4">4x per week</option>
                  <option value="5">5x per week</option>
                  <option value="6">6x per week</option>
                  <option value="7">7x per week</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="workout-difficulty" class="form-label">Difficulty Level</label>
                <div class="range">
                  <input type="range" class="form-range" min="1" max="5" id="workout-difficulty">
                  <div class="d-flex justify-content-between">
                    <span>Beginner</span>
                    <span>Intermediate</span>
                    <span>Advanced</span>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-workout">Save Workout</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Meal Modal -->
    <div class="modal fade" id="mealModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Log a Meal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="meal-form">
              <div class="mb-3">
                <label for="meal-name" class="form-label">Meal Name</label>
                <input type="text" class="form-control" id="meal-name" placeholder="e.g., Breakfast, Lunch, Dinner, Snack">
              </div>
              <div class="mb-3">
                <label for="meal-description" class="form-label">Description</label>
                <input type="text" class="form-control" id="meal-description" placeholder="e.g., Grilled Chicken Salad">
              </div>
              <div class="mb-3">
                <label for="meal-calories" class="form-label">Calories</label>
                <input type="number" class="form-control" id="meal-calories" placeholder="e.g., 500">
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="meal-protein" class="form-label">Protein (g)</label>
                  <input type="number" class="form-control" id="meal-protein" placeholder="e.g., 30">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="meal-carbs" class="form-label">Carbs (g)</label>
                  <input type="number" class="form-control" id="meal-carbs" placeholder="e.g., 50">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="meal-fat" class="form-label">Fat (g)</label>
                  <input type="number" class="form-control" id="meal-fat" placeholder="e.g., 15">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-meal">Save Meal</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- User Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">User Profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-4 mb-4 mb-md-0">
                <div class="text-center">
                  <div class="mb-3">
                    <div style="width: 120px; height: 120px; background-color: #e9ecef; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center;">
                      <i class="bi bi-person" style="font-size: 60px; color: #6c757d;"></i>
                    </div>
                  </div>
                  <h5 class="mb-1">John Doe</h5>
                  <p class="text-muted">Member since March 2023</p>
                  <div class="d-grid gap-2">
                    <button class="btn btn-sm btn-outline-primary" disabled>Change Profile Photo</button>
                  </div>
                </div>
              </div>
              <div class="col-md-8">
                <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal-tab-pane" type="button" role="tab">Personal Info</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="goals-tab" data-bs-toggle="tab" data-bs-target="#goals-tab-pane" type="button" role="tab">Goals</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="preferences-tab" data-bs-toggle="tab" data-bs-target="#preferences-tab-pane" type="button" role="tab">Preferences</button>
                  </li>
                </ul>
                <div class="tab-content p-3 border border-top-0 rounded-bottom" id="profileTabContent">
                  <div class="tab-pane fade show active" id="personal-tab-pane" role="tabpanel" tabindex="0">
                    <form id="personal-info-form">
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="user-first-name" class="form-label">First Name</label>
                          <input type="text" class="form-control" id="user-first-name" value="John">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="user-last-name" class="form-label">Last Name</label>
                          <input type="text" class="form-control" id="user-last-name" value="Doe">
                        </div>
                      </div>
                      <div class="mb-3">
                        <label for="user-email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="user-email" value="john.doe@example.com">
                      </div>
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="user-height" class="form-label">Height (cm)</label>
                          <input type="number" class="form-control" id="user-height" value="178">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="user-weight" class="form-label">Weight (kg)</label>
                          <input type="number" class="form-control" id="user-weight" value="75">
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="user-gender" class="form-label">Gender</label>
                          <select class="form-select" id="user-gender">
                            <option value="male" selected>Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="user-birthdate" class="form-label">Date of Birth</label>
                          <input type="date" class="form-control" id="user-birthdate" value="1990-01-01">
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="tab-pane fade" id="goals-tab-pane" role="tabpanel" tabindex="0">
                    <form id="goals-form">
                      <div class="mb-3">
                        <label for="goal-type" class="form-label">Primary Goal</label>
                        <select class="form-select" id="goal-type">
                          <option value="lose-weight" selected>Lose Weight</option>
                          <option value="maintain-weight">Maintain Weight</option>
                          <option value="gain-weight">Gain Weight/Muscle</option>
                          <option value="increase-endurance">Increase Endurance</option>
                          <option value="increase-strength">Increase Strength</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="activity-level" class="form-label">Activity Level</label>
                        <select class="form-select" id="activity-level">
                          <option value="1">Sedentary (little or no exercise)</option>
                          <option value="2" selected>Lightly active (light exercise 1-3 days/week)</option>
                          <option value="3">Moderately active (moderate exercise 3-5 days/week)</option>
                          <option value="4">Very active (hard exercise 6-7 days/week)</option>
                          <option value="5">Extra active (very hard exercise, physical job or training twice a day)</option>
                        </select>
                      </div>
                      <div class="mb-4">
                        <label class="form-label">Daily Goals</label>
                        <div class="row mb-2">
                          <div class="col-md-6">
                            <label for="goal-calories" class="form-label">Calories</label>
                            <input type="number" class="form-control" id="goal-calories" value="2000">
                          </div>
                          <div class="col-md-6">
                            <label for="goal-steps" class="form-label">Steps</label>
                            <input type="number" class="form-control" id="goal-steps" value="10000">
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-4">
                            <label for="goal-protein" class="form-label">Protein (g)</label>
                            <input type="number" class="form-control" id="goal-protein" value="140">
                          </div>
                          <div class="col-md-4">
                            <label for="goal-carbs" class="form-label">Carbs (g)</label>
                            <input type="number" class="form-control" id="goal-carbs" value="200">
                          </div>
                          <div class="col-md-4">
                            <label for="goal-fat" class="form-label">Fat (g)</label>
                            <input type="number" class="form-control" id="goal-fat" value="65">
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="tab-pane fade" id="preferences-tab-pane" role="tabpanel" tabindex="0">
                    <form id="preferences-form">
                      <div class="mb-3">
                        <label class="form-label">Units of Measurement</label>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="units" id="metric-units" value="metric" checked>
                          <label class="form-check-label" for="metric-units">
                            Metric (kg, cm, km)
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="units" id="imperial-units" value="imperial">
                          <label class="form-check-label" for="imperial-units">
                            Imperial (lb, ft, miles)
                          </label>
                        </div>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Notifications</label>
                        <div class="form-check form-switch mb-2">
                          <input class="form-check-input" type="checkbox" role="switch" id="reminder-notifications" checked>
                          <label class="form-check-label" for="reminder-notifications">Daily Reminders</label>
                        </div>
                        <div class="form-check form-switch mb-2">
                          <input class="form-check-input" type="checkbox" role="switch" id="goal-notifications" checked>
                          <label class="form-check-label" for="goal-notifications">Goal Achievements</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="weekly-notifications" checked>
                          <label class="form-check-label" for="weekly-notifications">Weekly Reports</label>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="save-profile">Save Changes</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <!-- Bootstrap JS and dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
  
  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the progress chart with sample data
      initializeProgressChart();
      // Initialize UI with placeholder data until the real data loads
      const placeholderData = {
        stepsCount: 5000,
        caloriesBurned: 400,
        activitiesLogged: 2,
        activities: [
          {
            name: 'Morning Run',
            calories: 250,
            duration: 30,
            type: 'running',
            date: new Date().toISOString()
          },
          {
            name: 'Weight Training',
            calories: 150,
            duration: 45,
            type: 'weights',
            date: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
          }
        ]
      };
      
      // Update UI with placeholder data
      updateUI(placeholderData);
      
      // Try to fetch tracking data from the server
      fetch('/api/tracker')
        .then(response => response.json())
        .then(data => {
          // Initialize UI with real data
          updateUI(data);
        })
        .catch(error => {
          console.error('Error fetching tracker data:', error);
          // Keep showing placeholder data
        });
      
      // Set up tab navigation
      setupTabNavigation();
      
      // Setup event listeners
      setupEventListeners();
    });
    
    // Update UI with tracker data
    function updateUI(data) {
      // Update stats
      document.getElementById('steps-count').textContent = (data.stepsCount || 0).toLocaleString();
      document.getElementById('calories-count').textContent = (data.caloriesBurned || 0).toLocaleString();
      document.getElementById('activities-count').textContent = (data.activitiesLogged || 0).toLocaleString();
      
      // Update activities list
      const activitiesList = document.getElementById('activities-list');
      activitiesList.innerHTML = '';
      
      if (!data.activities || data.activities.length === 0) {
        document.getElementById('no-activities').style.display = 'block';
      } else {
        document.getElementById('no-activities').style.display = 'none';
        
        data.activities.forEach(activity => {
          const activityElement = createActivityElement(activity);
          activitiesList.appendChild(activityElement);
        });
      }
    }
    
    // Create activity element
    function createActivityElement(activity) {
      const activityElement = document.createElement('div');
      activityElement.className = 'activity-item d-flex align-items-center';
      
      // Activity icon and color based on type
      let iconClass = 'bi-lightning';
      let iconColor = '#3498db';
      
      switch (activity.type) {
        case 'running':
          iconClass = 'bi-lightning';
          iconColor = '#3498db';
          break;
        case 'cycling':
          iconClass = 'bi-bicycle';
          iconColor = '#e74c3c';
          break;
        case 'weights':
          iconClass = 'bi-trophy';
          iconColor = '#9b59b6';
          break;
        case 'swimming':
          iconClass = 'bi-water';
          iconColor = '#2ecc71';
          break;
      }
      
      activityElement.innerHTML = `
        <div class="activity-icon" style="background-color: ${iconColor}20;">
          <i class="${iconClass}" style="color: ${iconColor};"></i>
        </div>
        <div>
          <div class="fw-bold">${activity.name}</div>
          <div class="text-muted small">${activity.calories} calories · ${activity.duration} min</div>
          <div class="activity-time">${formatDate(activity.date)}</div>
        </div>
      `;
      
      return activityElement;
    }
    
    // Create workout plan element
    function createWorkoutElement(workout) {
      const colElement = document.createElement('div');
      colElement.className = 'col-md-6 mb-3';
      
      // Define difficulty labels and colors
      const difficultyLabels = ['Easy', 'Light', 'Moderate', 'Challenging', 'Intense'];
      const difficultyColors = ['success', 'info', 'primary', 'warning', 'danger'];
      
      // Get the correct difficulty label and color (1-indexed)
      const difficultyIndex = Math.min(Math.max(workout.difficulty - 1, 0), 4);
      
      colElement.innerHTML = `
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">${workout.name}</h5>
            <span class="badge bg-${difficultyColors[difficultyIndex]} mb-2">${difficultyLabels[difficultyIndex]}</span>
            <p class="card-text">${workout.description}</p>
            <div class="d-flex justify-content-between align-items-center mt-3">
              <small class="text-muted">${workout.frequency}x per week</small>
              <button class="btn btn-sm btn-outline-primary">Start Workout</button>
            </div>
          </div>
        </div>
      `;
      
      return colElement;
    }
    
    // Create meal element
    function createMealElement(meal) {
      const mealElement = document.createElement('div');
      mealElement.className = 'card mb-3';
      
      mealElement.innerHTML = `
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="card-title">${meal.name}</h5>
              <h6 class="card-subtitle mb-2 text-muted">${meal.description}</h6>
              <div class="mt-2">
                <span class="badge bg-primary me-1">${meal.calories} cal</span>
                <span class="badge bg-success me-1">${meal.protein}g protein</span>
                <span class="badge bg-info me-1">${meal.carbs}g carbs</span>
                <span class="badge bg-warning me-1">${meal.fat}g fat</span>
              </div>
            </div>
            <div class="text-end">
              <small class="text-muted">${formatDate(meal.date)}</small>
            </div>
          </div>
        </div>
      `;
      
      return mealElement;
    }
    
    // Format date helper
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
    
    // Setup tab navigation
    function setupTabNavigation() {
      const dashboardTab = document.getElementById('dashboard-tab');
      const workoutsTab = document.getElementById('workouts-tab');
      const nutritionTab = document.getElementById('nutrition-tab');
      
      const dashboardContent = document.getElementById('dashboard-content');
      const workoutsContent = document.getElementById('workouts-content');
      const nutritionContent = document.getElementById('nutrition-content');
      
      // Dashboard tab
      dashboardTab.addEventListener('click', function(event) {
        event.preventDefault();
        setActiveTab(dashboardTab);
        setActiveContent(dashboardContent);
      });
      
      // Workouts tab
      workoutsTab.addEventListener('click', function(event) {
        event.preventDefault();
        setActiveTab(workoutsTab);
        setActiveContent(workoutsContent);
      });
      
      // Nutrition tab
      nutritionTab.addEventListener('click', function(event) {
        event.preventDefault();
        setActiveTab(nutritionTab);
        setActiveContent(nutritionContent);
      });
      
      // Helper function to set active tab
      function setActiveTab(tab) {
        [dashboardTab, workoutsTab, nutritionTab].forEach(t => {
          t.classList.remove('active');
        });
        tab.classList.add('active');
      }
      
      // Helper function to set active content
      function setActiveContent(content) {
        [dashboardContent, workoutsContent, nutritionContent].forEach(c => {
          c.style.display = 'none';
        });
        content.style.display = 'block';
      }
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Save steps button
      const saveStepsBtn = document.getElementById('save-steps');
      if (saveStepsBtn) {
        saveStepsBtn.addEventListener('click', function() {
          const stepsInput = document.getElementById('steps-input');
          const steps = parseInt(stepsInput.value);
          
          if (!isNaN(steps) && steps > 0) {
            // Send data to server
            fetch('/api/steps', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ steps }),
            })
            .then(response => response.json())
            .then(data => {
              // Update UI
              updateUI(data);
              
              // Close modal and reset form
              const modal = bootstrap.Modal.getInstance(document.getElementById('stepsModal'));
              modal.hide();
              document.getElementById('steps-form').reset();
              
              // Show success alert
              alert('Steps added successfully!');
            })
            .catch(error => {
              console.error('Error adding steps:', error);
              alert('Failed to add steps. Please try again.');
            });
          } else {
            alert('Please enter a valid number of steps');
          }
        });
      }
      
      // Save activity button
      const saveActivityBtn = document.getElementById('save-activity');
      if (saveActivityBtn) {
        saveActivityBtn.addEventListener('click', function() {
          const nameInput = document.getElementById('activity-name');
          const caloriesInput = document.getElementById('activity-calories');
          const durationInput = document.getElementById('activity-duration');
          const activityTypeEl = document.querySelector('input[name="activity-type"]:checked');
          
          const name = nameInput.value.trim();
          const calories = parseInt(caloriesInput.value);
          const duration = parseInt(durationInput.value);
          const type = activityTypeEl.value;
          
          if (!name || isNaN(calories) || isNaN(duration)) {
            alert('Please fill in all fields');
            return;
          }
          
          // Send data to server
          fetch('/api/activities', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name, calories, duration, type }),
          })
          .then(response => response.json())
          .then(data => {
            // Update UI
            updateUI(data);
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('activityModal'));
            modal.hide();
            document.getElementById('activity-form').reset();
            
            // Show success alert
            alert('Activity logged successfully!');
          })
          .catch(error => {
            console.error('Error logging activity:', error);
            alert('Failed to log activity. Please try again.');
            
            // If fetch fails, add activity locally
            const now = new Date();
            const placeholder = {
              stepsCount: parseInt(document.getElementById('steps-count').textContent.replace(/,/g, '')) || 0,
              caloriesBurned: parseInt(document.getElementById('calories-count').textContent.replace(/,/g, '')) + calories,
              activitiesLogged: parseInt(document.getElementById('activities-count').textContent.replace(/,/g, '')) + 1,
              activities: [{
                name: name,
                calories: calories,
                duration: duration,
                type: type,
                date: now.toISOString()
              }]
            };
            
            // Update UI with local data
            updateUI(placeholder);
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('activityModal'));
            modal.hide();
            document.getElementById('activity-form').reset();
          });
        });
      }
      
      // Save workout button
      const saveWorkoutBtn = document.getElementById('save-workout');
      if (saveWorkoutBtn) {
        saveWorkoutBtn.addEventListener('click', function() {
          const nameInput = document.getElementById('workout-name');
          const descriptionInput = document.getElementById('workout-description');
          const frequencyInput = document.getElementById('workout-frequency');
          const difficultyInput = document.getElementById('workout-difficulty');
          
          const name = nameInput.value.trim();
          const description = descriptionInput.value.trim();
          const frequency = parseInt(frequencyInput.value);
          const difficulty = parseInt(difficultyInput.value);
          
          if (!name || !description) {
            alert('Please fill in all required fields');
            return;
          }
          
          // Create a workout object
          const workout = {
            name: name,
            description: description,
            frequency: frequency,
            difficulty: difficulty,
            date: new Date().toISOString()
          };
          
          // Hide the 'no workout plans' message if it's visible
          document.getElementById('no-workout-plans').style.display = 'none';
          
          // Add the workout to the list
          const workoutList = document.getElementById('workout-list');
          const workoutElement = createWorkoutElement(workout);
          workoutList.appendChild(workoutElement);
          
          // Close modal and reset form
          const modal = bootstrap.Modal.getInstance(document.getElementById('workoutModal'));
          modal.hide();
          document.getElementById('workout-form').reset();
          
          // Show success alert
          alert('Workout plan created successfully!');
        });
      }
      
      // Save meal button
      const saveMealBtn = document.getElementById('save-meal');
      if (saveMealBtn) {
        saveMealBtn.addEventListener('click', function() {
          const nameInput = document.getElementById('meal-name');
          const descriptionInput = document.getElementById('meal-description');
          const caloriesInput = document.getElementById('meal-calories');
          const proteinInput = document.getElementById('meal-protein');
          const carbsInput = document.getElementById('meal-carbs');
          const fatInput = document.getElementById('meal-fat');
          
          const name = nameInput.value.trim();
          const description = descriptionInput.value.trim();
          const calories = parseInt(caloriesInput.value);
          const protein = parseInt(proteinInput.value) || 0;
          const carbs = parseInt(carbsInput.value) || 0;
          const fat = parseInt(fatInput.value) || 0;
          
          if (!name || !description || isNaN(calories)) {
            alert('Please fill in all required fields');
            return;
          }
          
          // Create a meal object
          const meal = {
            name: name,
            description: description,
            calories: calories,
            protein: protein,
            carbs: carbs,
            fat: fat,
            date: new Date().toISOString()
          };
          
          // Hide the 'no meals' message if it's visible
          document.getElementById('no-meals').style.display = 'none';
          
          // Add the meal to the list
          const mealList = document.getElementById('meal-list');
          const mealElement = createMealElement(meal);
          mealList.prepend(mealElement); // Add at the top
          
          // Update the daily calories counter
          const todayCalories = document.getElementById('today-calories');
          const currentCalories = parseInt(todayCalories.textContent) || 0;
          todayCalories.textContent = currentCalories + calories;
          
          // Update macronutrient percentages
          updateMacroPercentages(protein, carbs, fat);
          
          // Close modal and reset form
          const modal = bootstrap.Modal.getInstance(document.getElementById('mealModal'));
          modal.hide();
          document.getElementById('meal-form').reset();
          
          // Show success alert
          alert('Meal logged successfully!');
        });
      }
      
      // Function to update macronutrient percentages in the UI
      function updateMacroPercentages(protein, carbs, fat) {
        const totalGrams = protein + carbs + fat;
        if (totalGrams === 0) return;
        
        const proteinPerc = Math.round((protein / totalGrams) * 100);
        const carbsPerc = Math.round((carbs / totalGrams) * 100);
        const fatPerc = Math.round((fat / totalGrams) * 100);
        
        // Update the UI elements
        document.getElementById('protein-perc').textContent = proteinPerc;
        document.getElementById('carbs-perc').textContent = carbsPerc;
        document.getElementById('fat-perc').textContent = fatPerc;
        
        // Update the progress bars
        const progressBars = document.querySelectorAll('.progress-stacked .progress');
        progressBars[0].style.width = proteinPerc + '%';
        progressBars[1].style.width = carbsPerc + '%';
        progressBars[2].style.width = fatPerc + '%';
      }
      
      // Initialize the progress chart with sample data
      function initializeProgressChart() {
        const ctx = document.getElementById('progress-chart');
        
        // Sample data for the chart (7 days)
        const labels = [];
        const calorieData = [];
        const stepsData = [];
        
        // Generate dates for the last 7 days
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
          
          // Random data for demonstration
          calorieData.push(Math.floor(Math.random() * 500) + 100);
          stepsData.push(Math.floor(Math.random() * 5000) + 2000);
        }
        
        // Create the chart
        const progressChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Calories Burned',
                data: calorieData,
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                yAxisID: 'y'
              },
              {
                label: 'Steps',
                data: stepsData,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                yAxisID: 'y1'
              }
            ]
          },
          options: {
            responsive: true,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            scales: {
              y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                  display: true,
                  text: 'Calories'
                }
              },
              y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                  display: true,
                  text: 'Steps'
                },
                grid: {
                  drawOnChartArea: false
                }
              }
            }
          }
        });
        
        // Set up event listeners for the chart view toggle
        document.getElementById('weekly-view').addEventListener('click', function() {
          this.classList.add('active');
          document.getElementById('monthly-view').classList.remove('active');
          // In a real app, we would fetch weekly data and update the chart
        });
        
        document.getElementById('monthly-view').addEventListener('click', function() {
          this.classList.add('active');
          document.getElementById('weekly-view').classList.remove('active');
          // In a real app, we would fetch monthly data and update the chart
        });
      }
      
      // Save profile button
      const saveProfileBtn = document.getElementById('save-profile');
      if (saveProfileBtn) {
        saveProfileBtn.addEventListener('click', function() {
          // Here we would normally send data to the server
          // but for demo purposes, just show success message
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('profileModal'));
          modal.hide();
          
          // Show success alert
          alert('Profile updated successfully!');
        });
      }
    }
  </script>
</body>
</html>